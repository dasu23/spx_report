<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>测试覆盖率分析报告</title>
    <!-- 引入 ECharts -->
    <script src="https://cdn.jsdelivr.net/npm/echarts@5.4.0/dist/echarts.min.js"></script>
    <!-- 引入 Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600&display=swap" rel="stylesheet">
    <style>
        :root {
            --primary-color: #1890ff;
            --success-color: #52c41a;
            --warning-color: #faad14;
            --danger-color: #ff4d4f;
            --text-primary: #1f1f1f;
            --text-secondary: #8c8c8c;
            --bg-color: #f0f2f5;
            --card-bg: #ffffff;
            --border-radius: 8px;
            --box-shadow: 0 1px 2px -2px rgba(0, 0, 0, 0.16), 0 3px 6px 0 rgba(0, 0, 0, 0.12), 0 5px 12px 4px rgba(0,0,0,0.09);
            --hover-shadow: 0 6px 16px -8px rgba(0,0,0,0.08), 0 9px 28px 0 rgba(0,0,0,0.05), 0 12px 48px 16px rgba(0,0,0,0.03);
        }

        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
            background-color: var(--bg-color);
            margin: 0;
            padding: 0;
            color: var(--text-primary);
        }

        /* 顶部导航 */
        .navbar {
            background: #001529;
            color: white;
            padding: 0 24px;
            height: 64px;
            display: flex;
            align-items: center;
            justify-content: space-between;
            box-shadow: 0 2px 8px rgba(0,0,0,0.15);
        }
        .navbar .logo {
            font-size: 20px;
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        .navbar .time {
            font-size: 14px;
            color: rgba(255,255,255,0.65);
        }

        .container {
            max-width: 1400px;
            margin: 24px auto;
            padding: 0 24px;
        }

        /* 概览卡片 */
        .summary-row {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 24px;
            margin-bottom: 24px;
        }

        .card {
            background: var(--card-bg);
            border-radius: var(--border-radius);
            padding: 24px;
            box-shadow: var(--box-shadow);
            transition: all 0.3s;
            position: relative;
            overflow: hidden;
        }
        .card:hover {
            transform: translateY(-5px);
            box-shadow: var(--hover-shadow);
        }

        .stat-title {
            color: var(--text-secondary);
            font-size: 14px;
            margin-bottom: 8px;
        }
        .stat-value {
            font-size: 30px;
            font-weight: 600;
            color: var(--text-primary);
            font-family: 'Helvetica Neue', sans-serif;
        }
        .progress-bar-bg {
            height: 4px;
            background: #f5f5f5;
            border-radius: 2px;
            margin-top: 16px;
            overflow: hidden;
        }
        .progress-bar-fill {
            height: 100%;
            border-radius: 2px;
            transition: width 1s ease-in-out;
        }

        /* 图表布局 */
        .chart-row {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 24px;
            margin-bottom: 24px;
        }
        .chart-full {
            grid-column: span 2;
        }
        .chart-container {
            height: 400px;
            width: 100%;
        }
        .card-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            border-bottom: 1px solid #f0f0f0;
            padding-bottom: 12px;
        }
        .card-title {
            font-size: 16px;
            font-weight: 600;
            color: var(--text-primary);
        }

        /* 表格样式 */
        .data-table {
            width: 100%;
            border-collapse: collapse;
            font-size: 14px;
        }
        .data-table th {
            background: #fafafa;
            color: var(--text-primary);
            font-weight: 600;
            padding: 16px;
            text-align: left;
            border-bottom: 1px solid #f0f0f0;
        }
        .data-table td {
            padding: 16px;
            border-bottom: 1px solid #f0f0f0;
            color: var(--text-secondary);
        }
        .data-table tr:hover td {
            background: #fafafa;
        }
        .status-badge {
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 12px;
            background: #f5f5f5;
        }
        .status-high { background: #f6ffed; color: #52c41a; border: 1px solid #b7eb8f; }
        .status-mid { background: #e6f7ff; color: #1890ff; border: 1px solid #91d5ff; }
        .status-low { background: #fff1f0; color: #ff4d4f; border: 1px solid #ffa39e; }

        /* Footer */
        .footer {
            text-align: center;
            color: var(--text-secondary);
            margin-top: 40px;
            padding-bottom: 20px;
            font-size: 12px;
        }

        @media (max-width: 1024px) {
            .summary-row { grid-template-columns: repeat(2, 1fr); }
            .chart-row { grid-template-columns: 1fr; }
            .chart-full { grid-column: span 1; }
        }
        @media (max-width: 600px) {
            .summary-row { grid-template-columns: 1fr; }
            .navbar { flex-direction: column; height: auto; padding: 10px; }
        }
    </style>
</head>
<body>

    <div class="navbar">
        <div class="logo">
            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="white" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                <rect x="2" y="3" width="20" height="14" rx="2" ry="2"></rect>
                <line x1="8" y1="21" x2="16" y2="21"></line>
                <line x1="12" y1="17" x2="12" y2="21"></line>
            </svg>
            <span>自动化测试报告</span>
        </div>
        <div class="time">生成时间: 2025-12-01 16:09:14</div>
    </div>

    <div class="container">
        <!-- 概览卡片区域 -->
        <div class="summary-row">
            <div class="card">
                <div class="stat-title">总测试用例 (Total)</div>
                <div class="stat-value" id="totalCases">0</div>
                <div class="progress-bar-bg"><div class="progress-bar-fill" style="width: 100%; background: #1890ff;"></div></div>
            </div>
            <div class="card">
                <div class="stat-title">已完成 (Completed)</div>
                <div class="stat-value" id="completedCases" style="color: var(--success-color)">0</div>
                <div class="progress-bar-bg"><div class="progress-bar-fill" id="completedBar" style="width: 0%; background: var(--success-color);"></div></div>
            </div>
            <div class="card">
                <div class="stat-title">未完成 (Incomplete)</div>
                <div class="stat-value" id="incompleteCases" style="color: var(--danger-color)">0</div>
                <div class="progress-bar-bg"><div class="progress-bar-fill" id="incompleteBar" style="width: 0%; background: var(--danger-color);"></div></div>
            </div>
            <div class="card">
                <div class="stat-title">总完成率 (Rate)</div>
                <div class="stat-value" id="completionRate">0%</div>
                <div class="progress-bar-bg"><div class="progress-bar-fill" id="rateBar" style="width: 0%; background: #722ed1;"></div></div>
            </div>
        </div>

        <!-- 核心图表区域 -->
        <div class="chart-row">
            <!-- 单独一行：用例增长趋势 -->
            <div class="card chart-full">
                <div class="card-header">
                    <div class="card-title">用例增长趋势</div>
                </div>
                <div id="trendChart" class="chart-container"></div>
            </div>
        </div>

        <div class="chart-row">
            <!-- 左侧：总用例完成情况 -->
            <div class="card">
                <div class="card-header">
                    <div class="card-title">总用例完成情况</div>
                </div>
                <div id="pieChart" class="chart-container"></div>
            </div>
            <!-- 右侧：各模块完成情况分布 -->
            <div class="card">
                <div class="card-header">
                    <div class="card-title">各模块完成情况分布</div>
                </div>
                <div id="moduleStackChart" class="chart-container"></div>
            </div>
        </div>

        <!-- 详细数据表格 -->
        <div class="card">
            <div class="card-header">
                <div class="card-title">详细数据明细</div>
            </div>
            <div style="overflow-x: auto;">
                <table class="data-table" id="detailTable">
                    <thead>
                        <tr>
                            <th>模块名称</th>
                            <th>总用例数</th>
                            <th>已完成</th>
                            <th>未完成</th>
                            <th>完成率</th>
                            <th>状态评估</th>
                        </tr>
                    </thead>
                    <tbody>
                        <!-- JS 动态生成 -->
                    </tbody>
                </table>
            </div>
        </div>
    </div>

    <div class="footer">
        Automated Test Report System | Internal Use Only
    </div>

    <script>
        // 数据注入
        const rawData = [{"module": "dms", "total": 166, "completed": 107, "incomplete": 59, "rate": 64.46}, {"module": "oms", "total": 182, "completed": 55, "incomplete": 127, "rate": 30.22}, {"module": "pos", "total": 247, "completed": 138, "incomplete": 109, "rate": 55.87}, {"module": "pos_admin", "total": 96, "completed": 10, "incomplete": 86, "rate": 10.42}, {"module": "prod", "total": 8, "completed": 5, "incomplete": 3, "rate": 62.5}, {"module": "rps", "total": 80, "completed": 75, "incomplete": 5, "rate": 93.75}, {"module": "trk", "total": 66, "completed": 66, "incomplete": 0, "rate": 100.0}, {"module": "cps", "total": 45, "completed": 33, "incomplete": 12, "rate": 73.33}];
        const overallStats = {"total_cases": 890, "completed_cases": 489, "incomplete_cases": 401, "completion_rate": 54.94};
        const trendData = {"dates": ["2025-07", "2025-08", "2025-09", "2025-10", "2025-11", "2025-12", "2025-12-01"], "total_cases": [412, 426, 491, 544, 871, 890, 890], "completed_cases": [296, 329, 378, 406, 459, 489, 489]};

        // 数字滚动动画函数
        function animateValue(obj, start, end, duration, isPercent = false) {
            let startTimestamp = null;
            const step = (timestamp) => {
                if (!startTimestamp) startTimestamp = timestamp;
                const progress = Math.min((timestamp - startTimestamp) / duration, 1);
                let current = Math.floor(progress * (end - start) + start);

                if (isPercent) {
                    obj.innerHTML = (progress * (end - start) + start).toFixed(2) + '%';
                } else {
                    obj.innerHTML = current.toLocaleString();
                }

                if (progress < 1) {
                    window.requestAnimationFrame(step);
                }
            };
            window.requestAnimationFrame(step);
        }

        // 初始化页面数据
        document.addEventListener('DOMContentLoaded', () => {
            // 1. 设置概览卡片动画
            animateValue(document.getElementById('totalCases'), 0, overallStats.total_cases, 1000);
            animateValue(document.getElementById('completedCases'), 0, overallStats.completed_cases, 1000);
            animateValue(document.getElementById('incompleteCases'), 0, overallStats.incomplete_cases, 1000);
            animateValue(document.getElementById('completionRate'), 0, overallStats.completion_rate, 1000, true);

            // 进度条动画
            setTimeout(() => {
                document.getElementById('completedBar').style.width = overallStats.completion_rate + '%';
                document.getElementById('incompleteBar').style.width = (100 - overallStats.completion_rate) + '%';
                document.getElementById('rateBar').style.width = overallStats.completion_rate + '%';
            }, 200);

            // 2. 初始化图表
            initCharts();

            // 3. 渲染表格
            renderTable();
        });

        function initCharts() {
            const modules = rawData.map(i => i.module.toUpperCase());

            // --- Chart 1: 趋势面积图 ---
            const trendChart = echarts.init(document.getElementById('trendChart'));
            trendChart.setOption({
                tooltip: {
                    trigger: 'axis',
                    axisPointer: { type: 'cross', label: { backgroundColor: '#6a7985' } }
                },
                grid: { left: '3%', right: '4%', bottom: '3%', top: '10%', containLabel: true },
                xAxis: {
                    type: 'category',
                    boundaryGap: false,
                    data: trendData.dates,
                    axisLine: { lineStyle: { color: '#999' } }
                },
                yAxis: {
                    type: 'value',
                    splitLine: { lineStyle: { type: 'dashed', color: '#eee' } }
                },
                series: [
                    {
                        name: '总用例',
                        type: 'line',
                        stack: 'Total',
                        smooth: true,
                        lineStyle: { width: 0 },
                        showSymbol: false,
                        areaStyle: { opacity: 0.8, color: new echarts.graphic.LinearGradient(0, 0, 0, 1, [{ offset: 0, color: 'rgba(24, 144, 255, 0.3)' }, { offset: 1, color: 'rgba(24, 144, 255, 0.05)' }]) },
                        emphasis: { focus: 'series' },
                        label: {
                            show: true,
                            position: 'top',
                            color: '#1890ff',
                            formatter: function(params) {
                                // 只有当数值大于0时才显示标签
                                return params.value > 0 ? params.value : '';
                            }
                        },
                        data: trendData.total_cases
                    },
                    {
                        name: '已完成',
                        type: 'line',
                        stack: 'Total',
                        smooth: true,
                        lineStyle: { width: 2, color: '#52c41a' },
                        areaStyle: { opacity: 0.8, color: new echarts.graphic.LinearGradient(0, 0, 0, 1, [{ offset: 0, color: 'rgba(82, 196, 26, 0.4)' }, { offset: 1, color: 'rgba(82, 196, 26, 0.05)' }]) },
                        emphasis: { focus: 'series' },
                        label: {
                            show: true,
                            position: 'top',
                            color: '#52c41a',
                            formatter: function(params) {
                                // 只有当数值大于0时才显示标签
                                return params.value > 0 ? params.value : '';
                            }
                        },
                        data: trendData.completed_cases
                    }
                ]
            });

            // --- Chart 2: 堆叠柱状图 (Business Style) ---
            const stackChart = echarts.init(document.getElementById('moduleStackChart'));
            stackChart.setOption({
                tooltip: {
                    trigger: 'axis',
                    axisPointer: { type: 'shadow' },
                    backgroundColor: 'rgba(0,0,0,0.7)',
                    textStyle: { color: '#fff' },
                    padding: [10, 15]
                },
                legend: {
                    bottom: 0,
                    icon: 'circle',
                    itemGap: 20
                },
                grid: {
                    left: '2%', right: '2%', bottom: '10%', top: '5%',
                    containLabel: true
                },
                xAxis: {
                    type: 'category',
                    data: modules,
                    axisLine: { show: false },
                    axisTick: { show: false }
                },
                yAxis: {
                    type: 'value',
                    splitLine: { lineStyle: { type: 'dashed', color: '#eee' } }
                },
                series: [
                    {
                        name: '已完成',
                        type: 'bar',
                        stack: 'total',
                        barMaxWidth: 40,
                        itemStyle: { 
                            color: new echarts.graphic.LinearGradient(0, 0, 0, 1, [
                                { offset: 0, color: '#73d13d' },
                                { offset: 1, color: '#52c41a' }
                            ]),
                            borderRadius: [0, 0, 4, 4]
                        },
                        label: {
                            show: true,
                            position: 'insideTop',
                            color: '#fff',
                            formatter: function(params) {
                                // 只有当数值大于0时才显示标签
                                return params.value > 0 ? params.value : '';
                            }
                        },
                        data: rawData.map(i => i.completed)
                    },
                    {
                        name: '未完成',
                        type: 'bar',
                        stack: 'total',
                        itemStyle: { 
                            color: new echarts.graphic.LinearGradient(0, 0, 0, 1, [
                                { offset: 0, color: '#ff7875' },
                                { offset: 1, color: '#ff4d4f' }
                            ]),
                            borderRadius: [4, 4, 0, 0]
                        },
                        label: {
                            show: true,
                            position: 'insideBottom',
                            color: '#fff',
                            formatter: function(params) {
                                // 只有当数值大于0时才显示标签
                                return params.value > 0 ? params.value : '';
                            }
                        },
                        data: rawData.map(i => i.incomplete)
                    }
                ]
            });

            // --- Chart 3: 总用例完成情况饼图 ---
            const pieChart = echarts.init(document.getElementById('pieChart'));
            pieChart.setOption({
                tooltip: {
                    trigger: 'item',
                    formatter: '{b}: {c} ({d}%)'
                },
                legend: {
                    bottom: '0%',
                    left: 'center',
                    icon: 'circle'
                },
                series: [
                    {
                        type: 'pie',
                        radius: ['40%', '70%'],
                        avoidLabelOverlap: false,
                        itemStyle: {
                            borderRadius: 10,
                            borderColor: '#fff',
                            borderWidth: 2
                        },
                        label: {
                            show: false,
                            position: 'center'
                        },
                        emphasis: {
                            label: {
                                show: true,
                                fontSize: '16',
                                fontWeight: 'bold',
                                formatter: '{b}\n{d}%'
                            }
                        },
                        labelLine: {
                            show: false
                        },
                        data: [
                            { 
                                value: overallStats.completed_cases, 
                                name: '已完成',
                                itemStyle: { color: '#52c41a' }
                            },
                            { 
                                value: overallStats.incomplete_cases, 
                                name: '未完成',
                                itemStyle: { color: '#ff4d4f' }
                            }
                        ]
                    }
                ]
            });

            window.addEventListener('resize', () => {
                stackChart.resize();
                pieChart.resize();
                trendChart.resize();
            });
        }

        // 渲染详细数据表格
        function renderTable() {
            const tbody = document.querySelector('#detailTable tbody');
            let html = '';

            rawData.forEach(item => {
                let statusClass = 'status-low';
                let statusText = '需努力';
                if (item.rate >= 90) { statusClass = 'status-high'; statusText = '优秀'; }
                else if (item.rate >= 60) { statusClass = 'status-mid'; statusText = '良好'; }

                html += `
                    <tr>
                        <td style="font-weight:600">${item.module.toUpperCase()}</td>
                        <td>${item.total}</td>
                        <td style="color:var(--success-color)">${item.completed}</td>
                        <td style="color:var(--danger-color)">${item.incomplete}</td>
                        <td>
                            <div style="display:flex; align-items:center; gap:8px;">
                                <div style="width:50px; height:6px; background:#f0f0f0; border-radius:3px;">
                                    <div style="width:${item.rate}%; height:100%; background:${item.rate < 60 ? '#ff4d4f' : '#1890ff'}; border-radius:3px;"></div>
                                </div>
                                ${item.rate}%
                            </div>
                        </td>
                        <td><span class="status-badge ${statusClass}">${statusText}</span></td>
                    </tr>
                `;
            });

            tbody.innerHTML = html;
        }
    </script>
</body>
</html>
