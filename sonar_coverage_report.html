<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SonarQube 覆盖率报告</title>
    <script src="https://cdn.jsdelivr.net/npm/echarts@5.4.0/dist/echarts.min.js"></script>
    <style>
        body {
            font-family: 'Microsoft YaHei', Arial, sans-serif;
            margin: 0;
            padding: 20px;
            background-color: #f5f5f5;
        }
        .container {
            max-width: 1200px;
            margin: 0 auto;
        }
        .header {
            text-align: center;
            margin-bottom: 30px;
        }
        .header h1 {
            color: #333;
            margin-bottom: 10px;
        }
        .chart-container {
            background: white;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            padding: 20px;
            margin-bottom: 20px;
        }
        .chart-row {
            display: flex;
            flex-wrap: wrap;
            gap: 20px;
            margin-bottom: 20px;
        }
        .chart-box {
            flex: 1;
            min-width: 300px;
            height: 400px;
        }
        .summary {
            display: flex;
            justify-content: space-around;
            flex-wrap: wrap;
            gap: 20px;
            margin-bottom: 30px;
        }
        .summary-card {
            background: white;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            padding: 20px;
            text-align: center;
            flex: 1;
            min-width: 200px;
        }
        .summary-number {
            font-size: 2em;
            font-weight: bold;
            color: #1f77b4;
        }
        .summary-label {
            color: #666;
            margin-top: 5px;
        }
        table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
            background: white;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            overflow: hidden;
        }
        th, td {
            padding: 12px 15px;
            text-align: left;
            border-bottom: 1px solid #ddd;
        }
        th {
            background-color: #1f77b4;
            color: white;
        }
        tr:hover {
            background-color: #f5f5f5;
        }
        /* 突出显示新代码覆盖率低于50%的行 */
        tr.low-coverage {
            background-color: #ffebee !important;
        }
        tr.low-coverage td:nth-child(3) {
            color: #d32f2f;
            font-weight: bold;
        }
        .warning-icon {
            color: #d32f2f;
            margin-right: 5px;
        }
        @media (max-width: 768px) {
            .chart-box {
                min-width: 100%;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>SonarQube 覆盖率报告</h1>
            <p>生成时间: 2025-11-28 20:52:05</p>
        </div>
        
        <div class="chart-row">
            <div class="chart-box" id="overallCoverageChart"></div>
            <div class="chart-box" id="newCoverageChart"></div>
        </div>
        
        <div class="chart-container">
            <div class="chart-box" id="comparisonChart"></div>
        </div>
        
        <div class="chart-container">
            <h2 style="text-align: center;">详细数据</h2>
            <table>
                <thead>
                    <tr>
                        <th>项目</th>
                        <th>整体覆盖率 (%)</th>
                        <th>新代码覆盖率 (%)</th>
                        <th>生成时间</th>
                    </tr>
                </thead>
                <tbody>
                    <tr class="low-coverage">
                        <td>pos-exchange-api</td>
                        <td>3.7</td>
                        <td><span class="warning-icon">⚠️</span>41.0</td>
                        <td>2025-11-28 20:51:56</td>
                    </tr>
                    <tr class="">
                        <td>oms-api</td>
                        <td>27.0</td>
                        <td>57.3</td>
                        <td>2025-11-28 20:51:57</td>
                    </tr>
                    <tr class="low-coverage">
                        <td>tracking-api</td>
                        <td>0.0</td>
                        <td><span class="warning-icon">⚠️</span>0.0</td>
                        <td>2025-11-28 20:51:59</td>
                    </tr>
                    <tr class="low-coverage">
                        <td>pos-admin-api</td>
                        <td>1.6</td>
                        <td><span class="warning-icon">⚠️</span>5.1</td>
                        <td>2025-11-28 20:52:02</td>
                    </tr>
                    <tr class="">
                        <td>rps-api</td>
                        <td>6.3</td>
                        <td>50.8</td>
                        <td>2025-11-28 20:52:03</td>
                    </tr>
                    <tr class="low-coverage">
                        <td>drivermgmt-api</td>
                        <td>6.6</td>
                        <td><span class="warning-icon">⚠️</span>39.9</td>
                        <td>2025-11-28 20:52:04</td>
                    </tr>
                    <tr class="low-coverage">
                        <td>pos-api</td>
                        <td>1.7</td>
                        <td><span class="warning-icon">⚠️</span>2.2</td>
                        <td>2025-11-28 20:52:05</td>
                    </tr>
                </tbody>
            </table>
        </div>
    </div>

    <script>
        // 图表数据
        const projectNames = ["pos-exchange-api", "oms-api", "tracking-api", "pos-admin-api", "rps-api", "drivermgmt-api", "pos-api"];
        const overallCoverage = [3.7, 27.0, 0.0, 1.6, 6.3, 6.6, 1.7];
        const newCoverage = [41.0, 57.3, 0.0, 5.1, 50.8, 39.9, 2.2];
        // 低覆盖率项目索引
        const lowCoverageIndices = [0, 2, 3, 5, 6];

        // 整体覆盖率图表
        const overallCoverageChart = echarts.init(document.getElementById('overallCoverageChart'));
        const overallCoverageOption = {
            title: {
                text: '整体代码覆盖率',
                left: 'center'
            },
            tooltip: {
                trigger: 'axis',
                axisPointer: {
                    type: 'shadow'
                }
            },
            grid: {
                left: '3%',
                right: '4%',
                bottom: '3%',
                containLabel: true
            },
            xAxis: [
                {
                    type: 'category',
                    data: projectNames,
                    axisTick: {
                        alignWithLabel: true
                    },
                    axisLabel: {
                        rotate: 45
                    }
                }
            ],
            yAxis: [
                {
                    type: 'value',
                    name: '覆盖率 (%)'
                }
            ],
            series: [
                {
                    name: '整体覆盖率',
                    type: 'bar',
                    barWidth: '60%',
                    data: overallCoverage,
                    itemStyle: {
                        color: function(params) {
                            // 低覆盖率项目使用红色
                            if (lowCoverageIndices.includes(params.dataIndex)) {
                                return '#d32f2f';
                            }
                            return '#1f77b4';
                        },
                        borderRadius: 4
                    },
                    label: {
                        show: true,
                        position: 'top',
                        formatter: function(params) {
                            return params.value + '%';
                        }
                    }
                }
            ]
        };
        overallCoverageChart.setOption(overallCoverageOption);

        // 新代码覆盖率图表
        const newCoverageChart = echarts.init(document.getElementById('newCoverageChart'));
        const newCoverageOption = {
            title: {
                text: '新代码覆盖率',
                left: 'center'
            },
            tooltip: {
                trigger: 'axis',
                axisPointer: {
                    type: 'shadow'
                }
            },
            grid: {
                left: '3%',
                right: '4%',
                bottom: '3%',
                containLabel: true
            },
            xAxis: [
                {
                    type: 'category',
                    data: projectNames,
                    axisTick: {
                        alignWithLabel: true
                    },
                    axisLabel: {
                        rotate: 45
                    }
                }
            ],
            yAxis: [
                {
                    type: 'value',
                    name: '覆盖率 (%)'
                }
            ],
            series: [
                {
                    name: '新代码覆盖率',
                    type: 'bar',
                    barWidth: '60%',
                    data: newCoverage,
                    itemStyle: {
                        color: function(params) {
                            // 低覆盖率项目使用红色
                            if (lowCoverageIndices.includes(params.dataIndex)) {
                                return '#d32f2f';
                            }
                            return '#2ca02c';
                        },
                        borderRadius: 4
                    },
                    label: {
                        show: true,
                        position: 'top',
                        formatter: function(params) {
                            return params.value + '%';
                        }
                    }
                }
            ]
        };
        newCoverageChart.setOption(newCoverageOption);

        // 对比图表
        const comparisonChart = echarts.init(document.getElementById('comparisonChart'));
        const comparisonOption = {
            title: {
                text: '覆盖率对比',
                left: 'center'
            },
            tooltip: {
                trigger: 'axis',
                axisPointer: {
                    type: 'shadow'
                }
            },
            legend: {
                data: ['整体覆盖率', '新代码覆盖率'],
                top: '10%'
            },
            grid: {
                left: '3%',
                right: '4%',
                bottom: '3%',
                containLabel: true
            },
            xAxis: [
                {
                    type: 'category',
                    data: projectNames,
                    axisTick: {
                        alignWithLabel: true
                    },
                    axisLabel: {
                        rotate: 45
                    }
                }
            ],
            yAxis: [
                {
                    type: 'value',
                    name: '覆盖率 (%)'
                }
            ],
            series: [
                {
                    name: '整体覆盖率',
                    type: 'bar',
                    barGap: 0,
                    data: overallCoverage,
                    itemStyle: {
                        color: function(params) {
                            // 低覆盖率项目使用红色
                            if (lowCoverageIndices.includes(params.dataIndex)) {
                                return '#d32f2f';
                            }
                            return '#1f77b4';
                        },
                        borderRadius: [4, 4, 0, 0]
                    },
                    label: {
                        show: true,
                        position: 'top',
                        formatter: function(params) {
                            return params.value + '%';
                        }
                    }
                },
                {
                    name: '新代码覆盖率',
                    type: 'bar',
                    data: newCoverage,
                    itemStyle: {
                        color: function(params) {
                            // 低覆盖率项目使用红色
                            if (lowCoverageIndices.includes(params.dataIndex)) {
                                return '#d32f2f';
                            }
                            return '#2ca02c';
                        },
                        borderRadius: [4, 4, 0, 0]
                    },
                    label: {
                        show: true,
                        position: 'top',
                        formatter: function(params) {
                            return params.value + '%';
                        }
                    }
                }
            ]
        };
        comparisonChart.setOption(comparisonOption);

        // 响应式图表
        window.addEventListener('resize', function() {
            overallCoverageChart.resize();
            newCoverageChart.resize();
            comparisonChart.resize();
        });
    </script>
</body>
</html>