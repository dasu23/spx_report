<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SPX 测试覆盖率分析报告</title>
    <!-- 引入 ECharts -->
    <script src="https://cdn.jsdelivr.net/npm/echarts@5.4.0/dist/echarts.min.js"></script>
    <!-- 引入 Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <!-- 引入 Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        :root {
            /* 核心品牌色 - 更深沉专业的蓝 */
            --primary-color: #2563eb; 
            --primary-light: #eff6ff;
            --primary-dark: #1e40af;
            
            /* 语义化颜色 */
            --success-color: #10b981;
            --success-bg: #ecfdf5;
            --warning-color: #f59e0b;
            --warning-bg: #fffbeb;
            --danger-color: #ef4444;
            --danger-bg: #fef2f2;
            --info-color: #3b82f6;
            --info-bg: #eff6ff;

            /* 中性色系统 */
            --text-primary: #1e293b;   /* Slate 800 */
            --text-secondary: #64748b; /* Slate 500 */
            --text-tertiary: #94a3b8;  /* Slate 400 */
            --bg-body: #f8fafc;        /* Slate 50 */
            --bg-card: #ffffff;
            --border-color: #e2e8f0;   /* Slate 200 */
            
            /* 布局变量 */
            --header-height: 64px;
            --sidebar-width: 240px;
            --border-radius-sm: 6px;
            --border-radius: 12px;
            --border-radius-lg: 16px;
            
            /* 阴影系统 */
            --shadow-sm: 0 1px 2px 0 rgba(0, 0, 0, 0.05);
            --shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
            --shadow-md: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
            --shadow-lg: 0 20px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04);
            
            /* 动画 */
            --transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }

        * {
            box-sizing: border-box;
        }

        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
            background-color: var(--bg-body);
            margin: 0;
            padding: 0;
            color: var(--text-primary);
            line-height: 1.5;
            -webkit-font-smoothing: antialiased;
        }

        /* 顶部导航 */
        .navbar {
            background: rgba(255, 255, 255, 0.8);
            backdrop-filter: blur(12px);
            -webkit-backdrop-filter: blur(12px);
            border-bottom: 1px solid var(--border-color);
            height: var(--header-height);
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 0 24px;
            position: sticky;
            top: 0;
            z-index: 1000;
            box-shadow: var(--shadow-sm);
        }
        
        .navbar .brand {
            display: flex;
            align-items: center;
            gap: 12px;
            font-weight: 700;
            font-size: 18px;
            color: var(--text-primary);
        }
        
        .navbar .brand-icon {
            background: linear-gradient(135deg, var(--primary-color), var(--info-color));
            color: white;
            width: 32px;
            height: 32px;
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 16px;
        }

        .navbar .meta-info {
            display: flex;
            align-items: center;
            gap: 16px;
        }

        .tag {
            display: inline-flex;
            align-items: center;
            padding: 4px 10px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 500;
            background: var(--bg-body);
            color: var(--text-secondary);
            border: 1px solid var(--border-color);
        }

        /* 主容器 */
        .container {
            max-width: 1600px;
            margin: 24px auto;
            padding: 0 24px;
        }

        /* 通用卡片样式 */
        .card {
            background: var(--bg-card);
            border-radius: var(--border-radius);
            border: 1px solid var(--border-color);
            box-shadow: var(--shadow-sm);
            transition: var(--transition);
            overflow: hidden;
            display: flex;
            flex-direction: column;
        }

        .card:hover {
            transform: translateY(-2px);
            box-shadow: var(--shadow-md);
            border-color: #cbd5e1;
        }

        .card-header {
            padding: 16px 20px;
            border-bottom: 1px solid var(--border-color);
            display: flex;
            justify-content: space-between;
            align-items: center;
            background-color: white;
        }

        .card-title {
            font-size: 16px;
            font-weight: 600;
            color: var(--text-primary);
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .card-title i {
            color: var(--text-tertiary);
            font-size: 14px;
        }

        .card-body {
            padding: 20px;
            flex: 1;
        }

        /* 统计概览卡片 */
        .summary-grid {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 16px;
            margin-bottom: 24px;
        }

        .stat-card {
            padding: 20px;
            position: relative;
        }

        .stat-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 12px;
        }

        .stat-label {
            color: var(--text-secondary);
            font-size: 13px;
            font-weight: 500;
        }

        .stat-icon {
            width: 36px;
            height: 36px;
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 16px;
        }
        
        .stat-value-container {
            display: flex;
            align-items: baseline;
            gap: 8px;
        }

        .stat-value {
            font-size: 32px;
            font-weight: 700;
            letter-spacing: -1px;
            color: var(--text-primary);
        }

        .stat-trend {
            font-size: 13px;
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 4px;
        }
        
        .trend-up { color: var(--success-color); }
        .trend-down { color: var(--danger-color); }
        .trend-neutral { color: var(--text-secondary); }

        /* 图表布局 */
        .charts-grid {
            display: grid;
            grid-template-columns: 2fr 1fr;
            gap: 24px;
            margin-bottom: 24px;
        }
        
        .chart-container {
            width: 100%;
            height: 360px;
        }

        /* 数据表格 */
        .table-container {
            overflow-x: auto;
        }

        table {
            width: 100%;
            border-collapse: separate;
            border-spacing: 0;
        }

        th {
            background: var(--bg-body);
            color: var(--text-secondary);
            font-weight: 600;
            font-size: 13px;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            padding: 12px 24px;
            text-align: left;
            border-bottom: 1px solid var(--border-color);
        }

        td {
            padding: 16px 24px;
            border-bottom: 1px solid var(--border-color);
            color: var(--text-primary);
            font-size: 14px;
            transition: background 0.15s;
        }

        tr:last-child td {
            border-bottom: none;
        }

        tr:hover td {
            background-color: var(--bg-body);
        }
        
        /* 进度条组件 */
        .progress-track {
            height: 6px;
            background-color: var(--border-color);
            border-radius: 3px;
            overflow: hidden;
            width: 100%;
        }
        
        .progress-fill {
            height: 100%;
            border-radius: 3px;
            transition: width 1s cubic-bezier(0.4, 0, 0.2, 1);
        }

        /* 状态徽章 */
        .badge {
            display: inline-flex;
            align-items: center;
            gap: 6px;
            padding: 4px 10px;
            border-radius: 6px;
            font-size: 12px;
            font-weight: 600;
        }
        
        .badge-success { background: var(--success-bg); color: var(--success-color); border: 1px solid rgba(16, 185, 129, 0.2); }
        .badge-warning { background: var(--warning-bg); color: var(--warning-color); border: 1px solid rgba(245, 158, 11, 0.2); }
        .badge-danger { background: var(--danger-bg); color: var(--danger-color); border: 1px solid rgba(239, 68, 68, 0.2); }
        .badge-info { background: var(--info-bg); color: var(--info-color); border: 1px solid rgba(59, 130, 246, 0.2); }

        /* 响应式适配 */
        @media (max-width: 1200px) {
            .summary-grid { grid-template-columns: repeat(2, 1fr); }
            .charts-grid { grid-template-columns: 1fr; }
        }
        
        @media (max-width: 768px) {
            .summary-grid { grid-template-columns: 1fr; }
            .navbar { flex-direction: column; height: auto; padding: 16px; gap: 12px; }
            .container { padding: 16px; margin: 0; }
        }
    </style>
</head>
<body>

    <div class="navbar">
        <div class="brand">
            <div class="brand-icon">
                <i class="fas fa-vial"></i>
            </div>
            <span>SPX 测试覆盖率分析</span>
            <div class="tag">Beta v2.0</div>
        </div>
        <div class="meta-info">
            <div class="tag">
                <i class="far fa-clock" style="margin-right: 6px;"></i>
                2025-12-25 16:05:57
            </div>
            <a href="https://github.com/dasu23/spx_report" target="_blank" style="color: var(--text-secondary); font-size: 20px;">
                <i class="fab fa-github"></i>
            </a>
        </div>
    </div>

    <div class="container">
        <!-- 概览卡片区域 -->
        <div class="summary-grid">
            <div class="card stat-card">
                <div class="stat-header">
                    <div class="stat-label">总测试用例</div>
                    <div class="stat-icon" style="background: var(--info-bg); color: var(--info-color);">
                        <i class="fas fa-list-ul"></i>
                    </div>
                </div>
                <div class="stat-value-container">
                    <div class="stat-value" id="totalCases">0</div>
                    <div class="stat-trend trend-neutral">
                        <i class="fas fa-minus"></i>
                        <span>Total</span>
                    </div>
                </div>
                <div class="progress-track" style="margin-top: 16px;">
                    <div class="progress-fill" style="width: 100%; background: var(--info-color);"></div>
                </div>
            </div>
            
            <div class="card stat-card">
                <div class="stat-header">
                    <div class="stat-label">已完成</div>
                    <div class="stat-icon" style="background: var(--success-bg); color: var(--success-color);">
                        <i class="fas fa-check-circle"></i>
                    </div>
                </div>
                <div class="stat-value-container">
                    <div class="stat-value" id="completedCases" style="color: var(--success-color)">0</div>
                    <div class="stat-trend trend-up">
                        <i class="fas fa-arrow-up"></i>
                        <span>Done</span>
                    </div>
                </div>
                <div class="progress-track" style="margin-top: 16px;">
                    <div class="progress-fill" id="completedBar" style="width: 0%; background: var(--success-color);"></div>
                </div>
            </div>
            
            <div class="card stat-card">
                <div class="stat-header">
                    <div class="stat-label">未完成</div>
                    <div class="stat-icon" style="background: var(--danger-bg); color: var(--danger-color);">
                        <i class="fas fa-exclamation-circle"></i>
                    </div>
                </div>
                <div class="stat-value-container">
                    <div class="stat-value" id="incompleteCases" style="color: var(--danger-color)">0</div>
                    <div class="stat-trend trend-down">
                        <i class="fas fa-arrow-down"></i>
                        <span>Todo</span>
                    </div>
                </div>
                <div class="progress-track" style="margin-top: 16px;">
                    <div class="progress-fill" id="incompleteBar" style="width: 0%; background: var(--danger-color);"></div>
                </div>
            </div>
            
            <div class="card stat-card">
                <div class="stat-header">
                    <div class="stat-label">总体完成率</div>
                    <div class="stat-icon" style="background: #f3e8ff; color: #9333ea;">
                        <i class="fas fa-chart-pie"></i>
                    </div>
                </div>
                <div class="stat-value-container">
                    <div class="stat-value" id="completionRate" style="color: #9333ea;">0%</div>
                </div>
                <div class="progress-track" style="margin-top: 16px;">
                    <div class="progress-fill" id="rateBar" style="width: 0%; background: #9333ea;"></div>
                </div>
            </div>
        </div>

        <!-- 核心图表区域 -->
        <div class="charts-grid" style="grid-template-columns: 2fr 1fr;">
            <div class="card">
                <div class="card-header">
                    <div class="card-title">
                        <i class="fas fa-chart-line"></i>
                        用例增长趋势
                    </div>
                    <div class="tag">近 12 个月</div>
                </div>
                <div class="card-body">
                    <div id="trendChart" class="chart-container" style="height: 320px;"></div>
                </div>
            </div>
            
            <div class="card">
                <div class="card-header">
                    <div class="card-title">
                        <i class="fas fa-chart-pie"></i>
                        总用例完成情况
                    </div>
                </div>
                <div class="card-body">
                    <div id="completionPieChart" class="chart-container" style="height: 320px;"></div>
                </div>
            </div>
        </div>

        <div class="charts-grid">
            <!-- 左侧：各模块完成情况分布 -->
            <div class="card">
                <div class="card-header">
                    <div class="card-title">
                        <i class="fas fa-layer-group"></i>
                        各模块完成情况
                    </div>
                </div>
                <div class="card-body">
                    <div id="moduleStackChart" class="chart-container"></div>
                </div>
            </div>
            
            <!-- 右侧：覆盖率对比分析 -->
            <div class="card">
                <div class="card-header">
                    <div class="card-title">
                        <i class="fas fa-balance-scale"></i>
                        覆盖率对比分析
                    </div>
                </div>
                <div class="card-body">
                    <div id="coverageChart" class="chart-container"></div>
                </div>
            </div>
        </div>

        <!-- 详细数据表格 -->
        <div class="card">
            <div class="card-header">
                <div class="card-title">
                    <i class="fas fa-table"></i>
                    详细数据明细
                </div>
                <div class="tag">实时统计</div>
            </div>
            <div class="table-container">
                <table id="detailTable">
                    <thead>
                        <tr>
                            <th>模块名称</th>
                            <th>总用例数</th>
                            <th>已完成</th>
                            <th>未完成</th>
                            <th>测试完成率</th>
                            <th>代码覆盖率</th>
                            <th>执行通过率</th>
                        </tr>
                    </thead>
                    <tbody>
                        <!-- JS 动态生成 -->
                    </tbody>
                </table>
            </div>
        </div>
    </div>

    <script>
        // 数据注入
        const rawData = [{"module": "dms", "total": 175, "completed": 137, "incomplete": 38, "rate": 78.29, "code_coverage": 13.7, "new_code_coverage": 51.8, "exec_pass_rate": 75.78, "exec_failures": 31}, {"module": "oms", "total": 251, "completed": 167, "incomplete": 84, "rate": 66.53, "code_coverage": 26.8, "new_code_coverage": 63.0, "exec_pass_rate": 91.28, "exec_failures": 15}, {"module": "pos", "total": 249, "completed": 140, "incomplete": 109, "rate": 56.22, "code_coverage": 8.8, "new_code_coverage": 57.0, "exec_pass_rate": 76.81, "exec_failures": 32}, {"module": "pos_admin", "total": 95, "completed": 9, "incomplete": 86, "rate": 9.47, "code_coverage": 7.0, "new_code_coverage": 50.7, "exec_pass_rate": 0, "exec_failures": 0}, {"module": "prod", "total": 7, "completed": 4, "incomplete": 3, "rate": 57.14, "code_coverage": 0, "new_code_coverage": 0, "exec_pass_rate": 0, "exec_failures": 0}, {"module": "rps", "total": 83, "completed": 82, "incomplete": 1, "rate": 98.8, "code_coverage": 11.0, "new_code_coverage": 58.1, "exec_pass_rate": 79.73, "exec_failures": 15}, {"module": "trk", "total": 65, "completed": 65, "incomplete": 0, "rate": 100.0, "code_coverage": 19.1, "new_code_coverage": 58.0, "exec_pass_rate": 95.38, "exec_failures": 3}, {"module": "cps", "total": 44, "completed": 32, "incomplete": 12, "rate": 72.73, "code_coverage": 6.7, "new_code_coverage": 42.2, "exec_pass_rate": 0, "exec_failures": 0}];
        const overallStats = {"total_cases": 969, "completed_cases": 636, "incomplete_cases": 333, "completion_rate": 65.63};
        const trendData = {"dates": ["2025-07", "2025-08", "2025-09", "2025-10", "2025-11", "2025-12"], "total_cases": [412, 426, 491, 544, 871, 969], "completed_cases": [296, 329, 378, 406, 459, 636]};

        // 数字滚动动画函数
        function animateValue(obj, start, end, duration, isPercent = false) {
            let startTimestamp = null;
            const step = (timestamp) => {
                if (!startTimestamp) startTimestamp = timestamp;
                const progress = Math.min((timestamp - startTimestamp) / duration, 1);
                let current = Math.floor(progress * (end - start) + start);

                if (isPercent) {
                    obj.innerHTML = (progress * (end - start) + start).toFixed(2) + '%';
                } else {
                    obj.innerHTML = current.toLocaleString();
                }

                if (progress < 1) {
                    window.requestAnimationFrame(step);
                }
            };
            window.requestAnimationFrame(step);
        }

        // 初始化页面数据
        document.addEventListener('DOMContentLoaded', () => {
            // 1. 设置概览卡片动画
            animateValue(document.getElementById('totalCases'), 0, overallStats.total_cases, 1000);
            animateValue(document.getElementById('completedCases'), 0, overallStats.completed_cases, 1000);
            animateValue(document.getElementById('incompleteCases'), 0, overallStats.incomplete_cases, 1000);
            animateValue(document.getElementById('completionRate'), 0, overallStats.completion_rate, 1000, true);

            // 进度条动画
            setTimeout(() => {
                document.getElementById('completedBar').style.width = overallStats.completion_rate + '%';
                document.getElementById('incompleteBar').style.width = (100 - overallStats.completion_rate) + '%';
                document.getElementById('rateBar').style.width = overallStats.completion_rate + '%';
            }, 200);

            // 2. 初始化图表
            initCharts();

            // 3. 渲染表格
            renderTable();
        });

        function initCharts() {
            const modules = rawData.map(i => i.module.toUpperCase());

            // --- Chart 1: 趋势面积图 ---
            const trendChart = echarts.init(document.getElementById('trendChart'));
            trendChart.setOption({
                tooltip: {
                    trigger: 'axis',
                    axisPointer: { type: 'line', lineStyle: { color: '#94a3b8', width: 1, type: 'dashed' } },
                    backgroundColor: 'rgba(255, 255, 255, 0.95)',
                    borderColor: '#e2e8f0',
                    borderWidth: 1,
                    textStyle: { color: '#1e293b' },
                    extraCssText: 'box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1); padding: 12px;'
                },
                grid: { left: '3%', right: '4%', bottom: '5%', top: '12%', containLabel: true },
                toolbox: {
                    feature: {
                        saveAsImage: { title: '保存', iconStyle: { borderColor: '#94a3b8' }, emphasis: { iconStyle: { borderColor: '#2563eb' } } },
                        magicType: { 
                            show: true, 
                            type: ['line', 'bar'], 
                            title: { line: '折线图', bar: '柱状图' },
                            iconStyle: { borderColor: '#94a3b8' },
                            emphasis: { iconStyle: { borderColor: '#2563eb' } }
                        },
                        restore: { title: '还原', iconStyle: { borderColor: '#94a3b8' }, emphasis: { iconStyle: { borderColor: '#2563eb' } } }
                    },
                    top: 0,
                    right: 20,
                    itemSize: 14,
                    itemGap: 16
                },
                xAxis: {
                    type: 'category',
                    boundaryGap: false,
                    data: trendData.dates,
                    axisLine: { lineStyle: { color: '#cbd5e1' } },
                    axisLabel: { color: '#64748b', margin: 12 },
                    axisTick: { show: false }
                },
                yAxis: {
                    type: 'value',
                    splitLine: { lineStyle: { type: 'dashed', color: '#f1f5f9' } },
                    axisLabel: { color: '#64748b' }
                },
                series: [
                    {
                        name: '总用例',
                        type: 'line',
                        smooth: true,
                        symbol: 'circle',
                        symbolSize: 8,
                        lineStyle: { width: 4, color: '#2563eb', shadowColor: 'rgba(37, 99, 235, 0.2)', shadowBlur: 10 },
                        itemStyle: { color: '#2563eb', borderWidth: 2, borderColor: '#fff' },
                        areaStyle: {
                            color: new echarts.graphic.LinearGradient(0, 0, 0, 1, [
                                { offset: 0, color: 'rgba(37, 99, 235, 0.2)' },
                                { offset: 1, color: 'rgba(37, 99, 235, 0.0)' }
                            ])
                        },
                        label: {
                            show: true,
                            position: 'top',
                            color: '#fff',
                            backgroundColor: '#2563eb',
                            padding: [4, 8],
                            borderRadius: 4,
                            fontSize: 12,
                            fontWeight: 'bold',
                            formatter: '{c}',
                            shadowBlur: 4,
                            shadowColor: 'rgba(37, 99, 235, 0.3)',
                            distance: 10
                        },
                        data: trendData.total_cases
                    },
                    {
                        name: '已完成',
                        type: 'line',
                        smooth: true,
                        symbol: 'none',
                        lineStyle: { width: 3, color: '#10b981' },
                        areaStyle: {
                            color: new echarts.graphic.LinearGradient(0, 0, 0, 1, [
                                { offset: 0, color: 'rgba(16, 185, 129, 0.2)' },
                                { offset: 1, color: 'rgba(16, 185, 129, 0.0)' }
                            ])
                        },
                        data: trendData.completed_cases
                    }
                ]
            });

            // --- Chart 2: 堆叠柱状图 (Business Style) ---
            const stackChart = echarts.init(document.getElementById('moduleStackChart'));
            stackChart.setOption({
                title: {
                    subtext: '标注: 完成数 / 总数',
                    right: 0,
                    top: -5,
                    subtextStyle: { color: '#94a3b8', fontSize: 11 }
                },
                tooltip: {
                    trigger: 'axis',
                    axisPointer: { type: 'shadow' },
                    backgroundColor: 'rgba(255, 255, 255, 0.95)',
                    borderColor: '#e2e8f0',
                    borderWidth: 1,
                    textStyle: { color: '#1e293b' },
                    extraCssText: 'box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);'
                },
                legend: {
                    bottom: 0,
                    icon: 'circle',
                    itemGap: 20,
                    textStyle: { color: '#64748b' }
                },
                grid: {
                    left: '2%', right: '2%', bottom: '10%', top: '5%',
                    containLabel: true
                },
                xAxis: {
                    type: 'category',
                    data: modules,
                    axisLine: { show: false },
                    axisTick: { show: false },
                    axisLabel: {
                        color: '#64748b',
                        interval: 0,
                        rotate: 0,
                        fontSize: 12
                    }
                },
                yAxis: {
                    type: 'value',
                    splitLine: { lineStyle: { type: 'dashed', color: '#f1f5f9' } },
                    axisLabel: { color: '#64748b' }
                },
                series: [
                    {
                        name: '已完成',
                        type: 'bar',
                        stack: 'total',
                        barMaxWidth: 40,
                        itemStyle: {
                            color: new echarts.graphic.LinearGradient(0, 0, 0, 1, [
                                { offset: 0, color: '#34d399' },
                                { offset: 1, color: '#10b981' }
                            ]),
                            borderRadius: [0, 0, 4, 4]
                        },
                        label: {
                            show: false
                        },
                        data: rawData.map(i => i.completed)
                    },
                    {
                        name: '未完成',
                        type: 'bar',
                        stack: 'total',
                        itemStyle: {
                            color: new echarts.graphic.LinearGradient(0, 0, 0, 1, [
                                { offset: 0, color: '#f87171' },
                                { offset: 1, color: '#ef4444' }
                            ]),
                            borderRadius: [4, 4, 0, 0]
                        },
                        label: {
                            show: true,
                            position: 'top',
                            color: '#1e293b',
                            fontSize: 13,
                            fontFamily: 'Inter, sans-serif',
                            formatter: function(params) {
                                const data = rawData[params.dataIndex];
                                return '{a|' + data.completed + '}/{b|' + data.total + '}';
                            },
                            rich: {
                                a: { color: '#10b981', fontWeight: 600 },
                                b: { color: '#94a3b8' }
                            },
                            distance: 5
                        },
                        data: rawData.map(i => i.incomplete)
                    }
                ]
            });

            // --- Chart 3: 覆盖率对比分析 (Radar/Bar) ---
            const coverageChart = echarts.init(document.getElementById('coverageChart'));
            coverageChart.setOption({
                tooltip: {
                    trigger: 'axis',
                    axisPointer: { type: 'shadow' }
                },
                legend: {
                    bottom: 0,
                    data: ['测试完成率', '代码覆盖率']
                },
                radar: {
                    indicator: rawData.map(item => ({ name: item.module.toUpperCase(), max: 100 })),
                    radius: '65%',
                    splitNumber: 4,
                    axisName: {
                        color: '#64748b'
                    },
                    splitLine: {
                        lineStyle: {
                            color: [
                                'rgba(238, 197, 102, 0.1)',
                                'rgba(238, 197, 102, 0.2)',
                                'rgba(238, 197, 102, 0.4)',
                                'rgba(238, 197, 102, 0.6)',
                                'rgba(238, 197, 102, 0.8)',
                                'rgba(238, 197, 102, 1)'
                            ].reverse()
                        }
                    },
                    splitArea: {
                        show: false
                    },
                    axisLine: {
                        lineStyle: {
                            color: 'rgba(238, 197, 102, 0.5)'
                        }
                    }
                },
                series: [
                    {
                        name: '覆盖率对比',
                        type: 'radar',
                        data: [
                            {
                                value: rawData.map(i => i.rate),
                                name: '测试完成率',
                                itemStyle: { color: '#2563eb' },
                                areaStyle: { color: 'rgba(37, 99, 235, 0.2)' }
                            },
                            {
                                value: rawData.map(i => i.code_coverage),
                                name: '代码覆盖率',
                                itemStyle: { color: '#10b981' },
                                areaStyle: { color: 'rgba(16, 185, 129, 0.2)' }
                            }
                        ]
                    }
                ]
            });

            // --- Chart 4: 总用例完成情况饼图 ---
            const completionPieChart = echarts.init(document.getElementById('completionPieChart'));
            completionPieChart.setOption({
                tooltip: {
                    trigger: 'item',
                    formatter: '{a} <br/>{b}: {c} ({d}%)',
                    backgroundColor: 'rgba(255, 255, 255, 0.95)',
                    borderColor: '#e2e8f0',
                    borderWidth: 1,
                    textStyle: { color: '#1e293b' }
                },
                legend: {
                    bottom: 10,
                    icon: 'circle',
                    textStyle: { color: '#64748b' }
                },
                series: [{
                    name: '用例完成情况',
                    type: 'pie',
                    radius: ['45%', '70%'],
                    center: ['50%', '45%'],
                    avoidLabelOverlap: true,
                    itemStyle: {
                        borderRadius: 8,
                        borderColor: '#fff',
                        borderWidth: 2
                    },
                    label: {
                        show: true,
                        position: 'outside',
                        formatter: '{b}\n{c}',
                        color: '#1e293b',
                        fontSize: 12,
                        fontWeight: 500
                    },
                    labelLine: {
                        show: true,
                        length: 15,
                        length2: 10
                    },
                    emphasis: {
                        label: { show: true, fontSize: 14, fontWeight: 'bold' },
                        itemStyle: { shadowBlur: 10, shadowOffsetX: 0, shadowColor: 'rgba(0, 0, 0, 0.2)' }
                    },
                    data: [
                        { 
                            value: overallStats.completed_cases, 
                            name: '已完成',
                            itemStyle: { 
                                color: new echarts.graphic.LinearGradient(0, 0, 0, 1, [
                                    { offset: 0, color: '#34d399' },
                                    { offset: 1, color: '#10b981' }
                                ])
                            }
                        },
                        { 
                            value: overallStats.incomplete_cases, 
                            name: '未完成',
                            itemStyle: { 
                                color: new echarts.graphic.LinearGradient(0, 0, 0, 1, [
                                    { offset: 0, color: '#f87171' },
                                    { offset: 1, color: '#ef4444' }
                                ])
                            }
                        }
                    ]
                }]
            });

            window.addEventListener('resize', () => {
                stackChart.resize();
                coverageChart.resize();
                trendChart.resize();
                completionPieChart.resize();
            });
        }

        // 渲染详细数据表格
        function renderTable() {
            const tbody = document.querySelector('#detailTable tbody');
            let html = '';

            rawData.forEach(item => {
                const barColor = item.rate < 60 ? 'var(--danger-color)' : 
                               (item.rate >= 90 ? 'var(--success-color)' : 'var(--primary-color)');
                               
                const codeCovColor = item.code_coverage < 50 ? 'var(--danger-color)' : 'var(--info-color)';

                html += `
                    <tr>
                        <td style="font-weight:600">
                            <div style="display: flex; align-items: center; gap: 8px;">
                                <div style="width: 6px; height: 6px; border-radius: 50%; background: ${barColor}"></div>
                                ${item.module.toUpperCase()}
                            </div>
                        </td>
                        <td style="font-family: 'Inter', monospace;">${item.total}</td>
                        <td style="color:var(--success-color); font-weight:600; font-family: 'Inter', monospace;">${item.completed}</td>
                        <td style="color:var(--danger-color); font-family: 'Inter', monospace;">${item.incomplete}</td>
                        <td style="width: 18%;">
                            <div style="display:flex; align-items:center; gap:12px;">
                                <span style="font-family: 'Inter', monospace; font-size:13px; font-weight: 600; width: 45px;">${item.rate}%</span>
                                <div class="progress-track">
                                    <div class="progress-fill" style="width:${item.rate}%; background:${barColor};"></div>
                                </div>
                            </div>
                        </td>
                        <td style="width: 18%;">
                            <div style="display:flex; align-items:center; gap:12px;">
                                <span style="font-family: 'Inter', monospace; font-size:13px; font-weight: 600; width: 45px;">${item.code_coverage}%</span>
                                <div class="progress-track">
                                    <div class="progress-fill" style="width:${item.code_coverage}%; background:${codeCovColor};"></div>
                                </div>
                            </div>
                        </td>
                        <td style="width: 15%;">
                            <div style="display:flex; align-items:center; gap:8px;">
                                <span style="font-family: 'Inter', monospace; font-size:13px; font-weight: 600;">${item.exec_pass_rate || '-'}%</span>
                                ${item.exec_failures > 0 ? `<span class="badge badge-danger" style="font-size:10px">${item.exec_failures} Fail</span>` : ''}
                            </div>
                        </td>
                    </tr>
                `;
            });

            tbody.innerHTML = html;
        }
    </script>
</body>
</html>
