<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>测试覆盖率分析报告</title>
    <!-- 引入 ECharts -->
    <script src="https://cdn.jsdelivr.net/npm/echarts@5.4.0/dist/echarts.min.js"></script>
    <!-- 引入 Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600&display=swap" rel="stylesheet">
    <style>
        :root {
            --primary-color: #2563eb; /* 更现代的商务蓝 */
            --success-color: #10b981;
            --warning-color: #f59e0b;
            --danger-color: #ef4444;
            --text-primary: #1e293b;
            --text-secondary: #64748b;
            --bg-color: #f8fafc;
            --card-bg: #ffffff;
            --border-color: #e2e8f0;
            --border-radius: 12px;
            --box-shadow: 0 1px 3px 0 rgba(0, 0, 0, 0.1), 0 1px 2px 0 rgba(0, 0, 0, 0.06);
            --hover-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
        }

        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
            background-color: var(--bg-color);
            margin: 0;
            padding: 0;
            color: var(--text-primary);
            -webkit-font-smoothing: antialiased;
        }

        /* 顶部导航 - 极简白风格 */
        .navbar {
            background: #ffffff;
            color: var(--text-primary);
            padding: 0 32px;
            height: 70px;
            display: flex;
            align-items: center;
            justify-content: space-between;
            border-bottom: 1px solid var(--border-color);
            position: sticky;
            top: 0;
            z-index: 100;
        }
        .navbar .logo {
            font-size: 20px;
            font-weight: 700;
            display: flex;
            align-items: center;
            gap: 12px;
            color: #0f172a;
        }
        .navbar .time {
            font-size: 14px;
            color: var(--text-secondary);
            background: #f1f5f9;
            padding: 6px 12px;
            border-radius: 20px;
        }

        .container {
            max-width: 1400px;
            margin: 16px auto;
            padding: 0 16px;
        }

        /* 概览卡片 */
        .summary-row {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 16px;
            margin-bottom: 20px;
        }

        .card {
            background: var(--card-bg);
            border-radius: var(--border-radius);
            padding: 16px;
            border: 1px solid var(--border-color);
            box-shadow: var(--box-shadow);
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }
        .card:hover {
            transform: translateY(-4px);
            box-shadow: var(--hover-shadow);
            border-color: var(--primary-color);
        }

        .stat-title {
            color: var(--text-secondary);
            font-size: 12px;
            font-weight: 500;
            margin-bottom: 8px;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }
        .stat-value {
            font-size: 28px;
            font-weight: 700;
            color: var(--text-primary);
            letter-spacing: -1px;
            line-height: 1.2;
        }
        .progress-bar-bg {
            height: 6px;
            background: #f1f5f9;
            border-radius: 3px;
            margin-top: 12px;
            overflow: hidden;
        }
        .progress-bar-fill {
            height: 100%;
            border-radius: 3px;
            transition: width 1s cubic-bezier(0.4, 0, 0.2, 1);
        }

        /* 图表布局 */
        .chart-row {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 16px;
            margin-bottom: 20px;
        }
        .chart-full {
            grid-column: span 2;
        }
        .chart-container {
            height: 300px;
            width: 100%;
        }
        .card-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 16px;
            border-bottom: 1px solid #f1f5f9;
            padding-bottom: 12px;
        }
        .card-title {
            font-size: 16px;
            font-weight: 700;
            color: var(--text-primary);
            display: flex;
            align-items: center;
            gap: 8px;
        }
        .card-title::before {
            content: '';
            display: block;
            width: 4px;
            height: 20px;
            background: var(--primary-color);
            border-radius: 2px;
        }

        /* 表格样式 */
        .data-table {
            width: 100%;
            border-collapse: separate;
            border-spacing: 0;
            font-size: 13px;
        }
        .data-table th {
            background: #f8fafc;
            color: var(--text-secondary);
            font-weight: 600;
            padding: 12px 16px;
            text-align: left;
            border-bottom: 1px solid var(--border-color);
            first-child: border-top-left-radius: 8px;
            last-child: border-top-right-radius: 8px;
        }
        .data-table td {
            padding: 12px 16px;
            border-bottom: 1px solid var(--border-color);
            color: var(--text-primary);
            transition: background 0.2s;
        }
        .data-table tr:last-child td {
            border-bottom: none;
        }
        .data-table tr:hover td {
            background: #f8fafc;
        }
        .status-badge {
            padding: 6px 12px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 600;
        }
        .status-high { background: #dcfce7; color: #166534; }
        .status-mid { background: #dbeafe; color: #1e40af; }
        .status-low { background: #fee2e2; color: #991b1b; }

        /* Footer */
        .footer {
            text-align: center;
            color: var(--text-secondary);
            margin-top: 32px;
            padding-bottom: 20px;
            font-size: 12px;
            border-top: 1px solid var(--border-color);
            padding-top: 16px;
        }

        @media (max-width: 1024px) {
            .summary-row { grid-template-columns: repeat(2, 1fr); }
            .chart-row { grid-template-columns: 1fr; }
            .chart-full { grid-column: span 1; }
            .chart-container { height: 280px; }
        }
        @media (max-width: 600px) {
            .summary-row { grid-template-columns: 1fr; }
            .navbar { flex-direction: column; height: auto; padding: 16px; }
            .container { padding: 0 12px; }
            .chart-container { height: 260px; }
        }
    </style>
</head>
<body>

    <div class="navbar">
        <div class="logo">
            <svg width="28" height="28" viewBox="0 0 24 24" fill="none" stroke="#2563eb" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round">
                <rect x="2" y="3" width="20" height="14" rx="2" ry="2"></rect>
                <line x1="8" y1="21" x2="16" y2="21"></line>
                <line x1="12" y1="17" x2="12" y2="21"></line>
            </svg>
            <span>自动化测试报告</span>
        </div>
        <div class="time">生成时间: 2025-12-19 17:40:09</div>
    </div>

    <div class="container">
        <!-- 概览卡片区域 -->
        <div class="summary-row">
            <div class="card">
                <div class="stat-title">总测试用例 (Total)</div>
                <div class="stat-value" id="totalCases">0</div>
                <div class="progress-bar-bg"><div class="progress-bar-fill" style="width: 100%; background: #1890ff;"></div></div>
            </div>
            <div class="card">
                <div class="stat-title">已完成 (Completed)</div>
                <div class="stat-value" id="completedCases" style="color: var(--success-color)">0</div>
                <div class="progress-bar-bg"><div class="progress-bar-fill" id="completedBar" style="width: 0%; background: var(--success-color);"></div></div>
            </div>
            <div class="card">
                <div class="stat-title">未完成 (Incomplete)</div>
                <div class="stat-value" id="incompleteCases" style="color: var(--danger-color)">0</div>
                <div class="progress-bar-bg"><div class="progress-bar-fill" id="incompleteBar" style="width: 0%; background: var(--danger-color);"></div></div>
            </div>
            <div class="card">
                <div class="stat-title">总完成率 (Rate)</div>
                <div class="stat-value" id="completionRate">0%</div>
                <div class="progress-bar-bg"><div class="progress-bar-fill" id="rateBar" style="width: 0%; background: #722ed1;"></div></div>
            </div>
        </div>

        <!-- 核心图表区域 -->
        <div class="chart-row">
            <!-- 单独一行：用例增长趋势 -->
            <div class="card chart-full">
                <div class="card-header">
                    <div class="card-title">用例增长趋势</div>
                </div>
                <div id="trendChart" class="chart-container"></div>
            </div>
        </div>

        <div class="chart-row">
            <!-- 左侧：总用例完成情况 -->
            <div class="card">
                <div class="card-header">
                    <div class="card-title">总用例完成情况</div>
                </div>
                <div id="pieChart" class="chart-container"></div>
            </div>
            <!-- 右侧：各模块完成情况分布 -->
            <div class="card">
                <div class="card-header">
                    <div class="card-title">各模块完成情况分布</div>
                </div>
                <div id="moduleStackChart" class="chart-container"></div>
            </div>
        </div>

        <!-- 详细数据表格 -->
        <div class="card">
            <div class="card-header">
                <div class="card-title">详细数据明细</div>
            </div>
            <div style="overflow-x: auto;">
                <table class="data-table" id="detailTable">
                    <thead>
                        <tr>
                            <th>模块名称</th>
                            <th>总用例数</th>
                            <th>已完成</th>
                            <th>未完成</th>
                            <th>完成率</th>
                            <th>状态评估</th>
                        </tr>
                    </thead>
                    <tbody>
                        <!-- JS 动态生成 -->
                    </tbody>
                </table>
            </div>
        </div>
    </div>

    <div class="footer">
        Automated Test Report System | Internal Use Only
    </div>

    <script>
        // 数据注入
        const rawData = [{"module": "dms", "total": 172, "completed": 125, "incomplete": 47, "rate": 72.67}, {"module": "oms", "total": 246, "completed": 162, "incomplete": 84, "rate": 65.85}, {"module": "pos", "total": 246, "completed": 137, "incomplete": 109, "rate": 55.69}, {"module": "pos_admin", "total": 95, "completed": 9, "incomplete": 86, "rate": 9.47}, {"module": "prod", "total": 7, "completed": 4, "incomplete": 3, "rate": 57.14}, {"module": "rps", "total": 79, "completed": 78, "incomplete": 1, "rate": 98.73}, {"module": "trk", "total": 65, "completed": 65, "incomplete": 0, "rate": 100.0}, {"module": "cps", "total": 44, "completed": 32, "incomplete": 12, "rate": 72.73}];
        const overallStats = {"total_cases": 954, "completed_cases": 612, "incomplete_cases": 342, "completion_rate": 64.15};
        const trendData = {"dates": ["2025-07", "2025-08", "2025-09", "2025-10", "2025-11", "2025-12"], "total_cases": [412, 426, 491, 544, 871, 954], "completed_cases": [296, 329, 378, 406, 459, 612]};

        // 数字滚动动画函数
        function animateValue(obj, start, end, duration, isPercent = false) {
            let startTimestamp = null;
            const step = (timestamp) => {
                if (!startTimestamp) startTimestamp = timestamp;
                const progress = Math.min((timestamp - startTimestamp) / duration, 1);
                let current = Math.floor(progress * (end - start) + start);

                if (isPercent) {
                    obj.innerHTML = (progress * (end - start) + start).toFixed(2) + '%';
                } else {
                    obj.innerHTML = current.toLocaleString();
                }

                if (progress < 1) {
                    window.requestAnimationFrame(step);
                }
            };
            window.requestAnimationFrame(step);
        }

        // 初始化页面数据
        document.addEventListener('DOMContentLoaded', () => {
            // 1. 设置概览卡片动画
            animateValue(document.getElementById('totalCases'), 0, overallStats.total_cases, 1000);
            animateValue(document.getElementById('completedCases'), 0, overallStats.completed_cases, 1000);
            animateValue(document.getElementById('incompleteCases'), 0, overallStats.incomplete_cases, 1000);
            animateValue(document.getElementById('completionRate'), 0, overallStats.completion_rate, 1000, true);

            // 进度条动画
            setTimeout(() => {
                document.getElementById('completedBar').style.width = overallStats.completion_rate + '%';
                document.getElementById('incompleteBar').style.width = (100 - overallStats.completion_rate) + '%';
                document.getElementById('rateBar').style.width = overallStats.completion_rate + '%';
            }, 200);

            // 2. 初始化图表
            initCharts();

            // 3. 渲染表格
            renderTable();
        });

        function initCharts() {
            const modules = rawData.map(i => i.module.toUpperCase());

            // --- Chart 1: 趋势面积图 ---
            const trendChart = echarts.init(document.getElementById('trendChart'));
            trendChart.setOption({
                tooltip: {
                    trigger: 'axis',
                    axisPointer: { type: 'line', lineStyle: { color: '#94a3b8', width: 1, type: 'dashed' } },
                    backgroundColor: 'rgba(255, 255, 255, 0.95)',
                    borderColor: '#e2e8f0',
                    borderWidth: 1,
                    textStyle: { color: '#1e293b' },
                    extraCssText: 'box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1); padding: 12px;'
                },
                grid: { left: '3%', right: '4%', bottom: '15%', top: '12%', containLabel: true },
                toolbox: {
                    feature: {
                        saveAsImage: { title: '保存图片' },
                        dataZoom: { title: { zoom: '区域缩放', back: '还原' } },
                        magicType: { show: true, type: ['line', 'bar'], title: { line: '切换为折线图', bar: '切换为柱状图' } },
                        restore: { title: '还原' }
                    },
                    top: 0,
                    right: 20
                },
                dataZoom: [
                    {
                        type: 'slider',
                        show: true,
                        xAxisIndex: [0],
                        start: 0,
                        end: 100,
                        height: 20,
                        bottom: 10,
                        borderColor: 'transparent',
                        backgroundColor: '#f1f5f9',
                        fillerColor: 'rgba(37, 99, 235, 0.1)',
                        handleStyle: {
                            color: '#2563eb',
                            shadowBlur: 3,
                            shadowColor: 'rgba(0, 0, 0, 0.6)',
                            shadowOffsetX: 2,
                            shadowOffsetY: 2
                        }
                    },
                    {
                        type: 'inside',
                        xAxisIndex: [0],
                        start: 0,
                        end: 100
                    }
                ],
                xAxis: {
                    type: 'category',
                    boundaryGap: false,
                    data: trendData.dates,
                    axisLine: { lineStyle: { color: '#cbd5e1' } },
                    axisLabel: { color: '#64748b', margin: 12 },
                    axisTick: { show: false }
                },
                yAxis: {
                    type: 'value',
                    splitLine: { lineStyle: { type: 'dashed', color: '#f1f5f9' } },
                    axisLabel: { color: '#64748b' }
                },
                series: [
                    {
                        name: '总用例',
                        type: 'line',
                        smooth: true,
                        symbol: 'circle',
                        symbolSize: 8,
                        lineStyle: { width: 4, color: '#2563eb', shadowColor: 'rgba(37, 99, 235, 0.2)', shadowBlur: 10 },
                        itemStyle: { color: '#2563eb', borderWidth: 2, borderColor: '#fff' },
                        areaStyle: {
                            color: new echarts.graphic.LinearGradient(0, 0, 0, 1, [
                                { offset: 0, color: 'rgba(37, 99, 235, 0.2)' },
                                { offset: 1, color: 'rgba(37, 99, 235, 0.0)' }
                            ])
                        },
                        label: {
                            show: true,
                            position: 'top',
                            color: '#fff',
                            backgroundColor: '#2563eb',
                            padding: [4, 8],
                            borderRadius: 4,
                            fontSize: 12,
                            fontWeight: 'bold',
                            formatter: '{c}',
                            shadowBlur: 4,
                            shadowColor: 'rgba(37, 99, 235, 0.3)',
                            distance: 10
                        },
                        data: trendData.total_cases
                    },
                    {
                        name: '已完成',
                        type: 'line',
                        smooth: true,
                        symbol: 'none',
                        lineStyle: { width: 3, color: '#10b981' },
                        areaStyle: {
                            color: new echarts.graphic.LinearGradient(0, 0, 0, 1, [
                                { offset: 0, color: 'rgba(16, 185, 129, 0.2)' },
                                { offset: 1, color: 'rgba(16, 185, 129, 0.0)' }
                            ])
                        },
                        data: trendData.completed_cases
                    }
                ]
            });

            // --- Chart 2: 堆叠柱状图 (Business Style) ---
            const stackChart = echarts.init(document.getElementById('moduleStackChart'));
            stackChart.setOption({
                tooltip: {
                    trigger: 'axis',
                    axisPointer: { type: 'shadow' },
                    backgroundColor: 'rgba(255, 255, 255, 0.95)',
                    borderColor: '#e2e8f0',
                    borderWidth: 1,
                    textStyle: { color: '#1e293b' },
                    extraCssText: 'box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);'
                },
                legend: {
                    bottom: 0,
                    icon: 'circle',
                    itemGap: 20,
                    textStyle: { color: '#64748b' }
                },
                grid: {
                    left: '2%', right: '2%', bottom: '10%', top: '5%',
                    containLabel: true
                },
                xAxis: {
                    type: 'category',
                    data: modules,
                    axisLine: { show: false },
                    axisTick: { show: false },
                    axisLabel: {
                        color: '#64748b',
                        interval: 0,
                        rotate: 0,
                        fontSize: 12
                    }
                },
                yAxis: {
                    type: 'value',
                    splitLine: { lineStyle: { type: 'dashed', color: '#f1f5f9' } },
                    axisLabel: { color: '#64748b' }
                },
                series: [
                    {
                        name: '已完成',
                        type: 'bar',
                        stack: 'total',
                        barMaxWidth: 40,
                        itemStyle: {
                            color: new echarts.graphic.LinearGradient(0, 0, 0, 1, [
                                { offset: 0, color: '#34d399' },
                                { offset: 1, color: '#10b981' }
                            ]),
                            borderRadius: [0, 0, 4, 4]
                        },
                        label: {
                            show: false
                        },
                        data: rawData.map(i => i.completed)
                    },
                    {
                        name: '未完成',
                        type: 'bar',
                        stack: 'total',
                        itemStyle: {
                            color: new echarts.graphic.LinearGradient(0, 0, 0, 1, [
                                { offset: 0, color: '#f87171' },
                                { offset: 1, color: '#ef4444' }
                            ]),
                            borderRadius: [4, 4, 0, 0]
                        },
                        label: {
                            show: true,
                            position: 'top',
                            color: '#1e293b',
                            fontSize: 14,
                            fontWeight: 'bold',
                            formatter: function(params) {
                                const data = rawData[params.dataIndex];
                                const percentage = ((data.completed / data.total) * 100).toFixed(1);
                                return percentage + '%';
                            },
                            distance: 5
                        },
                        data: rawData.map(i => i.incomplete)
                    }
                ]
            });

            // --- Chart 3: 总用例完成情况饼图 ---
            const pieChart = echarts.init(document.getElementById('pieChart'));
            pieChart.setOption({
                tooltip: {
                    trigger: 'item',
                    formatter: '{b}: {c} ({d}%)',
                    backgroundColor: 'rgba(255, 255, 255, 0.95)',
                    borderColor: '#e2e8f0',
                    textStyle: { color: '#1e293b' }
                },
                legend: {
                    bottom: '0%',
                    left: 'center',
                    icon: 'circle',
                    textStyle: { color: '#64748b' }
                },
                series: [
                    {
                        type: 'pie',
                        radius: ['45%', '70%'],
                        avoidLabelOverlap: false,
                        itemStyle: {
                            borderRadius: 10,
                            borderColor: '#fff',
                            borderWidth: 2
                        },
                        label: {
                            show: true,
                            position: 'outside',
                            formatter: '{b}: {d}%',
                            fontSize: 14,
                            fontWeight: '500',
                            color: '#64748b'
                        },
                        labelLine: {
                            show: true,
                            length: 10,
                            length2: 20,
                            lineStyle: {
                                color: '#e2e8f0'
                            }
                        },
                        emphasis: {
                            label: {
                                show: true,
                                fontSize: '16',
                                fontWeight: 'bold',
                                color: '#1e293b'
                            },
                            itemStyle: {
                                shadowBlur: 10,
                                shadowOffsetX: 0,
                                shadowColor: 'rgba(0, 0, 0, 0.5)'
                            }
                        },
                        data: [
                            {
                                value: overallStats.completed_cases,
                                name: '已完成',
                                itemStyle: { color: '#10b981' }
                            },
                            {
                                value: overallStats.incomplete_cases,
                                name: '未完成',
                                itemStyle: { color: '#ef4444' }
                            }
                        ]
                    }
                ]
            });

            window.addEventListener('resize', () => {
                stackChart.resize();
                pieChart.resize();
                trendChart.resize();
            });
        }

        // 渲染详细数据表格
        function renderTable() {
            const tbody = document.querySelector('#detailTable tbody');
            let html = '';

            rawData.forEach(item => {
                let statusClass = 'status-low';
                let statusText = '需努力';
                if (item.rate >= 90) { statusClass = 'status-high'; statusText = '优秀'; }
                else if (item.rate >= 60) { statusClass = 'status-mid'; statusText = '良好'; }

                const barColor = item.rate < 60 ? '#ef4444' : '#2563eb';

                html += `
                    <tr>
                        <td style="font-weight:600">${item.module.toUpperCase()}</td>
                        <td>${item.total}</td>
                        <td style="color:var(--success-color); font-weight:600;">${item.completed}</td>
                        <td style="color:var(--danger-color);">${item.incomplete}</td>
                        <td>
                            <div style="display:flex; align-items:center; gap:8px;">
                                <div style="width:50px; height:6px; background:#f1f5f9; border-radius:3px; overflow:hidden;">
                                    <div style="width:${item.rate}%; height:100%; background:${barColor}; border-radius:3px;"></div>
                                </div>
                                <span style="font-family: 'Inter', sans-serif; font-size:13px;">${item.rate}%</span>
                            </div>
                        </td>
                        <td><span class="status-badge ${statusClass}">${statusText}</span></td>
                    </tr>
                `;
            });

            tbody.innerHTML = html;
        }
    </script>
</body>
</html>
